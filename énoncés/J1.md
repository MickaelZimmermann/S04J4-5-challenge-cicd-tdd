# CI/CD

On part de zÃ©ro et on envoie un projet en ligne automatiquement ! Ã‡a te tente ?

## Etapes

### Coquille vide

On commence par crÃ©er un projet Ã  partir d'un template. Pour Ã§a on va utiliser le bundler Vite.

Voici un petit lien vers la doc : https://vitejs.dev/guide/#scaffolding-your-first-vite-project

Avec Ã§a crÃ©e-toi un projet `Vanilla` en `Typescript` dans le dossier `app`

<details>
<summary>ğŸ›Ÿ Un peu d'aide ?</summary>

* `npm create vite@latest app` pour utiliser Vite afin de crÃ©er le projet
    * Vanilla
    * Typescript
* `cd app` pour se dÃ©placer dans le dossier `app` qui vient d'Ãªtre crÃ©Ã©
* `npm i` pour installer les dÃ©pendance du projet
* `npm run dev` pour dÃ©marrer le serveur de dev
</details>

> Ca fonctionne ! On a un projet de dÃ©mo de compteur incrÃ©mental ğŸ¥³

### Workflow

On touche pas au code (pour aujourd'hui). On va se crÃ©er un workflow avec des GitHub actions.

Pour savoir comment on fait, va voir par lÃ  : https://docs.github.com/fr/actions

<details>
<summary>ğŸ›Ÿ Un peu d'aide ?</summary>

* CrÃ©er un fichier `.github\workflows\deploy.yml`
* Remplir le workflow pour :
  * se placer dans `app` [Aide](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#defaultsrun)
  * faire l'installation des dÃ©pendances
  * faire le build
  * faire la mise en ligne sur GitHub Pages
* Commit et push pour tester le workflow
</details>

> Woooooh le workflow dÃ©marre ! Mais il ne passe pas ^^ Pourquoi ?

<details>
<summary>RÃ©ponse</summary>
Le repo n'est pas encore compatible avec GitHub Pages.
</details>

### Configuration du repo

Pour qu'on puisse envoyer des fichiers sur GitHub Pages, il faut :

* Rendre le repo public (parce qu'on est des pinces :D)
* Activer GitHub Pages pour les GitHub Actions
* Relancer le workflow

> Ca fonctionne ! Et l'appli ? Pourquoi ?

<details>
<summary>RÃ©ponse</summary>
On dirait que les assets (js, css...) ne sont pas trouvÃ©s. Il va les chercher Ã  la racine, mais l'url nous place dans un dossier (le nom du repo).
</details>

### Configuration de Vite

Pour palier Ã  ce problÃ¨me, on va modifier le chemin des assets. 

Regarde Ã§a : https://vitejs.dev/config/shared-options.html#base

<details>
<summary>ğŸ›Ÿ Un peu d'aide ?</summary>

* CrÃ©er un fichier `vite.config.ts`
* Renseigner le paramÃ¨tre `base` avec la valeur `.` (pour dossier courant)
* Build en local pour vÃ©rifier le chemin des assets dans `dist/index.html`
* Commit
</details>

> Bouya ğŸš€

On s'est bien dÃ©brouillÃ© ! On va plus loin ?

### Surge.sh

On ne veut pas laisser le repo en public, du coup GitHub Pages ne sera pas possible. Un pote nous a parlÃ© de surge.

https://surge.sh/

Wouha c'est ouf ce truc ! Essayons dans la console dÃ©jÃ  :

* `npm install --global surge` pour ajouter la dÃ©pendance
* `surge`
* on a une url en sous-domaine !

A priori, on peut mÃªme choisir notre sous-domaine ou le domaine directement : https://surge.sh/help/remembering-a-domain

### DÃ©ploiement auto avec surge

On va migrer notre workflow pour dÃ©ployer sur surge. GrÃ¢ce Ã  Ã§a on pourra remettre notre repo en privÃ© :D

Pour pas perdre notre travail, on va se crÃ©er une nouvelle branche `surge`. Ensuite duplique `deploy.yml` et renomme-le en `deploy-surge.yml` et enfin modifie le contenu.

Un peu d'aide ici : https://github.com/yavisht/deploy-via-surge.sh-github-action-template

