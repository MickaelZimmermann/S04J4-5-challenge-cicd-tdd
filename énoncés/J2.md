# Tests

Le Test-Driven Development (TDD) est une approche de d√©veloppement o√π vous √©crivez des tests avant de coder votre fonctionnalit√©.

Nous allons ajouter la fonctionnalit√© de d√©cr√©mentation du compteur sur le projet en utilisant l'approche TDD. Ensuite, on fera des folies :D

## Configuration de l'environnement de test

Avant de commencer, tu dois configurer l'environnement de test. On utilise le bundler Vite actuellement. Il n'est pas directement compatible avec les framework de test tel que Jest. Du coup, on va ajouter [Vitest](https://vitest.dev/) √† notre projet !

`npm install -D vitest`

## √âcriture du premier test

Objectif : √©crire le test de la fonction `decrementCounter` avant de l'impl√©menter.

Je te guide un peu : 

* Cr√©e un dossier `tests` dans `app`
* Cr√©e un fichier `counter.test.ts` dans le dossier
* Importe la future fonction `decrementCounter` du fichier `/app/src/counter.ts`
* √âcris la fonction de test qui "devrait d√©cr√©menter le compteur de 1"
  * Exemple, si on d√©finit le compteur √† `5`, puisqu'on appelle la fonction `decrementCounter`, on devrait avoir un compteur √† `4`

## Impl√©mentation de la fonction

Une fois que tu as √©crit ton test, tu peux aller cr√©er la fonction dans `counter.ts`. ‚ö†Ô∏è Je te conseille de faire un refacto du code car il est bof üòâ

## Lancement du test

Plus qu'√† test le test üôà

On va le faire avec la commande `npm run test`. Avant, il faut configurer cette commande dans le `package.json` :

```json
"scripts": {
  "dev": "vite",
  "build": "tsc && vite build",
  "preview": "vite preview",
  "test": "vitest"
},
```

Une fois le test lanc√©, tu devrais voir que √ßa passe (ou non) Fais un test pour la fonction d'incr√©ment tant que tu es l√† :D

## Int√©gration √† la CI/CD

L'id√©al est d'impl√©menter l'√©tape de test dans le pipeline pour ne pas avoir de sueurs froides quand on push du code. 

Va voir par l√† : https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs#building-and-testing-your-code

Une fois que tu as fait la modification, commit + push et va voir le workflow dans le repo.

Tu peux faire une erreur volontairement dans la fonction `decrementCounter` pour voir ce qu'il se passe ü§ì

## Bonus : compteur de nombres premiers

Tout est dans le titre ! Tu dois d√©sormais afficher que des nombres premiers quand tu incr√©mentes ou d√©cr√©mentes le compteur.

‚ö†Ô∏è On commence par √©crire les tests

Il faut :

* tester une liste de nombre premier et attendre `true`
* tester une liste de nombre **non** premier et attendre `false`
* Le premier nombre premier est 2, donc on ne doit pas aller en dessous quand on d√©cr√©mente
* Incr√©menter plusieurs fois et s'attendre √† avoir 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37...
* D√©cr√©menter plusieurs fois √† partir de 37 et s'attendre √† 31, 29, 23, 19, 17, 13, 11, 7, 5, 3, 2